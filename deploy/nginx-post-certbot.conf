# =============================================================================
# Post-Certbot Nginx Additions
# =============================================================================
# After running certbot --nginx, add these lines to your HTTPS server block
# in /etc/nginx/sites-available/cascadingtrust
#
# Certbot will create an HTTPS server block that looks like:
#
#   server {
#       listen 443 ssl;
#       server_name cascadingtrust.net www.cascadingtrust.net;
#       ssl_certificate /etc/letsencrypt/live/cascadingtrust.net/fullchain.pem;
#       ssl_certificate_key /etc/letsencrypt/live/cascadingtrust.net/privkey.pem;
#       include /etc/letsencrypt/options-ssl-nginx.conf;
#       ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
#       
#       # ... your location blocks ...
#   }
#
# Add these lines INSIDE the HTTPS server block, after the ssl_dhparam line:
# =============================================================================

    # =========================================================================
    # Security Headers (HTTPS-specific)
    # =========================================================================
    
    # HSTS - Force HTTPS for 1 year (enable after confirming HTTPS works)
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Prevent clickjacking
    add_header X-Frame-Options "SAMEORIGIN" always;
    
    # Prevent MIME type sniffing
    add_header X-Content-Type-Options "nosniff" always;
    
    # Enable XSS protection
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Referrer policy
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Permissions Policy (optional - restricts browser features)
    # add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    
    # Content Security Policy (adjust as needed for your frontend)
    # add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;" always;

# =============================================================================
# Enable Rate Limiting
# =============================================================================
# 1. Copy rate-limiting.conf to /etc/nginx/conf.d/:
#    sudo cp deploy/rate-limiting.conf /etc/nginx/conf.d/
#
# 2. Uncomment the limit_req lines in the HTTPS server block:
#    - limit_req zone=api_limit burst=20 nodelay;
#    - limit_req zone=auth_limit burst=5 nodelay;
#    - limit_req zone=general_limit burst=100 nodelay;
#
# 3. Test and reload:
#    sudo nginx -t && sudo systemctl reload nginx
# =============================================================================

