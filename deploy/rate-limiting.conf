# Rate Limiting Configuration for CascadingTrust
# Place this file in /etc/nginx/conf.d/rate-limiting.conf
# or include these lines in the http {} block of /etc/nginx/nginx.conf

# Rate limit for general API endpoints (10 requests/second per IP)
# Allows burst of 20 requests
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

# Rate limit for authentication endpoints (1 request/second per IP)
# This is intentionally restrictive to prevent brute force attacks
# The backend already has a 1.5 second delay on password validation
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=1r/s;

# Rate limit for general frontend requests (50 requests/second per IP)
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=50r/s;

# Optional: Rate limit by server (for admin endpoints from localhost)
# limit_req_zone $server_name zone=admin_limit:1m rate=100r/s;

# Log format for rate limiting (optional)
# log_format rate_limit '$remote_addr - $remote_user [$time_local] '
#                       '"$request" $status $body_bytes_sent '
#                       '"$http_referer" "$http_user_agent" '
#                       'rt=$request_time uct="$upstream_connect_time" '
#                       'uht="$upstream_header_time" urt="$upstream_response_time"';

